<div class="loading" ng-show="loading"></div>

<business-reports-explore-header></business-reports-explore-header>

<div class="container-fluid cubes-explorer" style="margin-top: 25px;">
  <div class="row-fluid">
    <div class="col-xs-12">
      <div class="cv-bootstrap" ng-controller="CubesViewerStudioController" ng-init="studioViewsService.resetService()">

        <i class="fa fa-pie-chart" id="reports-bg" ng-if="studioViewsService.views.length < 1"></i>

        <div class="cv-gui-panel hidden-print" ng-if="studioViewsService.views.length > 0">

          <div class="dropdown m-b" style="display: inline-block;">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>
              <i class="fa fa-fw fa-cube"></i> Nova visualização <span class="caret"></span>
            </button>

            <ul class="dropdown-menu cv-gui-cubeslist-menu">

              <li ng-show="cubesService.state === 1" class="disabled"><a>Carregando...</a></li>
              <li ng-show="cubesService.state === 2 && cubesService.cubesserver._cube_list.length === 0"
                  class="disabled"><a>Nenhum repositório encontrado.</a></li>
              <li ng-show="cubesService.state === 3" class="disabled text-danger"><a>Carregamento falhou</a></li>

              <li ng-repeat="cube in cubesService.cubesserver._cube_list | orderBy:'label'"
                  ng-click="studioViewsService.addViewCube(cube.name)"><a>{{ cube.label }}</a></li>

            </ul>
          </div>


          <div ng-if="cvOptions.backendUrl" class="dropdown m-b" style="display: inline-block; ">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>
              <i class="fa fa-fw fa-file"></i> Visualizações salvas <span class="caret"></span>
            </button>

            <ul class="dropdown-menu cv-gui-catalog-menu">

              <li class="dropdown-header">Visualizações pessoais</li>

              <li ng-repeat="sv in reststoreService.savedViews | orderBy:'sv.name'" ng-if="sv.owner == cvOptions.user"
                  ng-click="reststoreService.addSavedView(sv.id)"><a
                style="max-width: 360px; overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap;"><i
                class="fa fa-fw"></i> {{ sv.name }}</a></li>

              <li class="dropdown-header">Compartilhado por outros</li>

              <li ng-repeat="sv in reststoreService.savedViews | orderBy:'sv.name'"
                  ng-if="sv.shared && sv.owner != cvOptions.user" ng-click="reststoreService.addSavedView(sv.id)"><a
                style="max-width: 360px; overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap;"><i
                class="fa fa-fw"></i> {{ sv.name }}</a></li>

            </ul>
          </div>


          <div class="dropdown m-b" style="display: inline-block; margin-left: 5px;">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>
              <i class="fa fa-fw fa-wrench"></i> Ferramentas <span class="caret"></span>
            </button>

            <ul class="dropdown-menu">

              <li ng-click="showSerializeAdd()"><a tabindex="0"><i class="fa fa-fw fa-code"></i> Adicionar visualização
                por
                JSON...</a></li>

              <div class="divider"></div>

              <li ng-click="toggleTwoColumn()"
                  ng-class="{ 'hidden-xs': ! cvOptions.studioTwoColumn, 'disabled': studioViewsService.views.length == 0 }">
                <a tabindex="0"><i class="fa fa-fw fa-columns"></i> 2 colunas
                  <span class="label label-default" style="margin-left: 10px;"
                        ng-class="{ 'label-success': cvOptions.studioTwoColumn }">{{ cvOptions.studioTwoColumn ? "ON" : "OFF" }}</span></a>
              </li>
              <li ng-click="toggleHideControls()" ng-class="{ 'disabled': studioViewsService.views.length == 0 }"><a
                tabindex="0"><i class="fa fa-fw fa-unlock-alt"></i> Esconder controles
                <span class="label label-default" style="margin-left: 10px;"
                      ng-class="{ 'label-success': cvOptions.hideControls }">{{ cvOptions.hideControls ? "ON" : "OFF" }}</span></a>
              </li>
            </ul>
          </div>

          <div style="display: inline-block; margin-left: 10px; margin-bottom: 0px;">

            <div class="form-group hidden-xs" style="display: inline-block; margin-bottom: 0px;">
              <button class="btn" type="button" title="2 colunas" ng-disabled="studioViewsService.views.length == 0"
                      ng-class="cvOptions.studioTwoColumn ? 'btn-active btn-success' : 'btn-primary'"
                      ng-click="toggleTwoColumn()"><i class="fa fa-fw fa-columns"></i></button>
            </div>
            <div class="form-group" style="display: inline-block; margin-bottom: 0px;">
              <button class="btn" type="button" title="Esconder controles"
                      ng-disabled="studioViewsService.views.length == 0"
                      ng-class="cvOptions.hideControls ? 'btn-active btn-success' : 'btn-primary'"
                      ng-click="toggleHideControls()"><i class="fa fa-fw fa-unlock-alt"></i></button>
            </div>

          </div>
        </div>

        <div ng-if="studioViewsService.views.length < 1" id="reports-welcome">
          <h2>Bem vindo ao navegador de dados do ZUP!</h2>
          <p>Que tipo de informação você gostaria de navegar?</p>
          <div ng-repeat="cube in cubesService.cubesserver._cube_list | orderBy:'label'">
            <button class="btn btn-primary"
                    ng-click="studioViewsService.addViewCube(cube.name)">{{ cube.label }}
            </button>
            <br/>
          </div>
        </div>

        <div class="cv-gui-workspace">

          <div class="row">
            <div ng-if="cubesService.state == 3" class="col-xs-12" style="margin-bottom: 10px;">
              <div class="alert alert-danger" style="margin: 0px;">
                <p>Não foi possível se conectar ao servidor: {{ cubesService.stateText }}</p>
              </div>
            </div>
          </div>

          <div class="row cv-views-container">

            <div class="col-xs-1 cv-views-gridsizer"></div>

            <div ng-repeat="studioView in compact(studioViewsService.views)" style="display: none; position: relative;"
                 class="col-xs-12 cv-view-container sv{{ studioView.id }}"
                 ng-class="(cvOptions.studioTwoColumn ? 'col-sm-6' : 'col-sm-12')">
              <div>
                <div cv-studio-view view="studioView"></div>
              </div>
            </div>

          </div>

        </div>

      </div>


    </div>
  </div>
</div>
