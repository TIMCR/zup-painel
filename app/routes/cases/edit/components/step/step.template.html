<div class="case-content principal">
  <div class="case-header edit-case clearfix">
    <h2>{{ step.flow_step.title }}</h2>

    <p>{{ 'CASE_RESPONSIBLE' | translate | lowercase }}: <span>{{ step.conductor.name }}</span> <a ng-click="changeConductor()" ng-if="canExecute(step)">(Alterar)</a></p>
  </div>

  <div class="case-sub-header" ng-if="futureStep">
    <p>Essa etapa não pode ser preenchida até que a etapa anterior seja concluída.</p>
  </div>

  <div class="case-sub-header" ng-if="!editable && !futureStep">
    <p class="pull-left" ng-if="lastUpdateDate">
      Esta etapa já foi preenchida.
      Última edição: {{ lastUpdateDate }} (<a href="" ng-click="openUserPage(lastUpdateUserId)">{{ lastUpdateUserName }}</a>)
    </p>
    <p class="pull-left" ng-if="!lastUpdateDate">
      Modo de visualização.
    </p>
    <a href="" class="pull-right" ng-click="toggleEditable()" ng-if="canExecute(step)">Editar</a>
  </div>

  <div class="clearfix"></div>

  <form novalidate action="#" name="stepForm">
    <fieldset>
      <div class="form-group" ng-repeat="field in step.flow_step.fields">
        <case-step-field field="field" view-mode="stepFilled ? 'display' : 'edit'" editable="editable" display-errors="displayErrors" step-form="stepForm"></case-step-field>
      </div>

      <div class="case-footer form-group last-group clearfix">
        <a ng-if="editable && !saveInProgress" class="btn btn-util" ng-click="toggleEditable()">
          <span class="glyphicon glyphicon-remove"></span> Cancelar edição
        </a>
        <a ng-if="editable && !saveInProgress && (!formSubmitted || isFormValid())" class="btn btn-info btn-custom" ng-click="saveStep()">
          <span class="glyphicon glyphicon-ok"></span> Concluir etapa
        </a>
        <button disabled="disabled" ng-if="displayErrors && formSubmitted && !isFormValid()" class="btn btn-custom btn-danger pull-right">
          <span class="glyphicon glyphicon-alert"></span> Existem campos que precisam ser corrigidos.
        </button>
        <a ng-if="saveInProgress" class="btn disabled btn-info btn-custom">
          <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Salvando...
        </a>
      </div>
    </fieldset>
  </form>
</div>
