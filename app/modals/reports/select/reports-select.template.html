<div class="modal-header">
  <button type="button" class="close" ng-click="close()">&times;</button>
  <h4 class="modal-title">Inserir relato</h4>
</div>
<div class="modal-body" lr-infinite-scroll="getReports">
  <table id="reports-listing-table" class="table custom_table items-listing-table">
    <thead>
    <tr>
      <td style="width: 5px" id="reports-listing-status"></td>
      <td ng-repeat="column in activeColumns"
          width="{{column.width}}"
          ng-click="sortableColumn[column.type] && changeSorting(column.type)"
          class="column-{{column.type}} ng-class:{ 'sort-table': sortableColumn[column.type]}">
        {{ column.label }}
      </td>
      <td style="min-width: 80px" id="reports-listing-actions"></td>
    </tr>
    </thead>

    <tbody>
    <tr ng-repeat="report in reports" ng-class="{'late_report': report.overdue }">
      <td class="status_color" ng-style="{'background-color': report.status.color}"></td>
      <td ng-repeat="column in activeColumns" class="column-{{column.type}}">
        <!-- Protocol -->
        <div style="text-align: center" ng-if="column.type == 'protocol'">
          <a ng-href="#/reports/{{ report.id }}">{{ report.protocol }}<b
            ng-hide="hasPermission('reports_full_access') || hasPermission('reports_categories_edit', report.category.id) || hasPermission('reports_items_edit', report.category.id) || hasPermission('reports_items_read_private', report.category.id)">Protocolo
            indisponível</b></a>
        </div>

        <!-- Address -->
        <div ng-if="column.type == 'address'">{{ report.address }}</div>

        <!-- User -->
        <div ng-if="column.type == 'user'">
          <a ng-href="#/users/{{ report.user.id }}"><span class="glyphicon glyphicon-user"></span></a>
          {{ report.user.name }}
        </div>

        <!-- Reporter -->
        <div ng-if="column.type == 'reporter'">
          <a ng-href="#/users/{{ report.reporter.id }}" ng-if="report.reporter"><span
            class="glyphicon glyphicon-user"></span></a> {{ report.reporter.name }}
        </div>

        <!-- Category -->
        <div ng-if="column.type == 'category'">
          {{ report.category.title }}
        </div>

        <!-- Assignment -->
        <div ng-if="column.type == 'assignment'">
          <span ng-if="report.assigned_group && report.assigned_user">
              <a ng-href="#/users/{{ report.assigned_user.id }}">
                <span class="glyphicon glyphicon-user"></span>
              </a> {{ report.assigned_user.name.split(' ')[0] }} ({{ report.assigned_group.name }})
          </span>
          <span ng-if="report.assigned_group && !report.assigned_user">{{ report.assigned_group.name }}</span>
          <a ng-if="!report.assigned_group && report.assigned_user" ng-href="#/users/{{ report.assigned_user.id }}">{{
            report.assigned_user.name }}</a>
          <span ng-if="!report.assigned_user && !report.assigned_group">Não atribuído</span>
        </div>

        <!-- Create date -->
        <div ng-if="column.type == 'created_at'">
          {{ report.created_at | date:'dd/MM/yy HH:mm'}}
        </div>

        <!-- Custom field -->
        <div ng-if="column.type == 'custom_field'">
          {{ report.custom_fields[column.id] || 'Não informado' }}
        </div>

        <!-- Priority -->
        <div ng-if="column.type == 'priority'">
          {{ report.category.priority_pretty || 'N/A' }}
        </div>
      </td>

      <td class="actions">
        <button type="button"
                class="btn btn-info btn-custom"
                ng-click="insertReport(report)"
                ng-if="!isInsertedReport(report)">
          + Inserir
        </button>
        <button type="button"
                class="btn"
                ng-click="removeReport(report)"
                ng-if="isInsertedReport(report)">
          &#x2713; Inserido
        </button>
      </td>
    </tr>
    </tbody>
  </table>
  <div class="loadingScrolling" ng-show="loadingPagination"></div>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-fat-custom btn-default" ng-click="close()">Cancelar</button>
  <button type="button" class="btn btn-fat-custom btn-primary" ng-click="confirm()">Salvar</button>
</div>
